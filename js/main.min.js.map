{"version":3,"sources":["main.js"],"names":["Generator","canvas","undefined","ctx","lat","lon","place","width","height","deg","Math","random","init","_this","this","document","getElementById","getContext","getLocation","$","ajax","url","dataType","type","error","jqXHR","textStatus","errorThrown","console","log","success","data","unescoData","QUERYRESULT","DATA","unescoObj","floor","length","getFlickr","response","loadFlickrImage","flickrPhotos","photos","photo","flickrObj","flickrUrl","urlToData","drawBackground","img","Image","onload","multiplier","offset","naturalHeight","naturalWidth","drawImage","drawGlobie","src","globie","rotate","html","saveImage","canvasData","toDataURL","callback","outputFormat","crossOrigin","dataURL","createElement","jQuery","ready"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global jQuery, $, document, Generator, Modernizr */\n\nGenerator = {\n  canvas: undefined,\n  ctx: undefined,\n  lat: undefined,\n  lon: undefined,\n  place: undefined,\n  width: 1000,\n  height: 1000,\n  deg: Math.random() * (-0.3 - 0.3) + 0.3,\n\n  init: function() {\n    var _this = this;\n\n    _this.canvas = document.getElementById('generator');\n    _this.ctx = _this.canvas.getContext('2d');\n    _this.getLocation();\n\n  },\n\n  getLocation: function() {\n    var _this = this;\n\n    $.ajax({\n      url: 'unesco.json',\n      dataType: 'json',\n      type: 'GET',\n      error: function(jqXHR, textStatus, errorThrown) {\n        console.log('jqXHR', jqXHR);\n        console.log('textStatus', textStatus);\n        console.log('errorThrown', errorThrown);\n      },\n      success: function(data) {\n        var unescoData = data.QUERYRESULT.DATA;\n        var unescoObj = Math.floor(Math.random() * (unescoData.length + 1));\n        _this.lat = unescoData[unescoObj][0];\n        _this.lon = unescoData[unescoObj][1];\n        _this.place = unescoData[unescoObj][5];\n\n        _this.getFlickr();\n      }\n    });\n\n  },\n\n  getFlickr: function() {\n    var _this = this;\n\n    $.ajax({\n      url: 'https://api.flickr.com/services/rest/?' +\n      'method=flickr.photos.search' +\n      '&api_key=731a3dc1069a15969d725a3805acc530' +\n      '&lat=' + _this.lat +\n      '&lon=' + _this.lon +\n      '&extras=url_l' +\n      '&format=json' +\n      '&jsoncallback=?',\n      dataType: 'jsonp',\n      type: 'GET',\n      error: function(jqXHR, textStatus, errorThrown) {\n        console.log('jqXHR', jqXHR);\n        console.log('textStatus', textStatus);\n        console.log('errorThrown', errorThrown);\n      },\n      success: function(response) {\n        console.log('Flickr Response', response);\n\n        _this.loadFlickrImage(response);\n      }\n    });\n\n  },\n\n  loadFlickrImage: function(response) {\n    var _this = this;\n    var flickrPhotos = response.photos.photo;\n\n    if (flickrPhotos !== 'undefined') {\n      var flickrObj = Math.floor(Math.random() * (flickrPhotos.length + 1));\n      var flickrUrl = flickrPhotos[flickrObj]['url_l'];\n\n      _this.urlToData(flickrUrl, function(data) {\n        _this.drawBackground(data);\n      });\n\n    } else {\n      _this.getFlickr();\n    }\n\n  },\n\n  drawBackground: function(data) {\n    var _this = this;\n    var img = new Image();\n\n    img.onload = function() {\n      var height = img.naturalHeight;\n      var width = img.naturalWidth;\n      var multiplier;\n      var offset;\n\n      if (height === width) {\n\n        // handle square image\n        multiplier = _this.height / height;\n        _this.ctx.drawImage(img, 0, 0, (width * multiplier), (height * multiplier));\n\n      } else if (height > width) {\n\n        // handle portrait\n        multiplier = _this.width / width;\n        offset = (((height * multiplier)-_this.height) / 2);\n\n        _this.ctx.drawImage(img, 0, -offset, (width * multiplier), (height * multiplier));\n\n      } else {\n\n        // handle landscape\n        multiplier = _this.height / height;\n        offset = (((width * multiplier)-_this.width) / 2);\n\n        _this.ctx.drawImage(img, -offset, 0, (width * multiplier), (height * multiplier));\n\n      }\n\n      _this.drawGlobie(_this.deg);\n\n    };\n    img.src = data;\n\n  },\n\n  drawGlobie: function() {\n    var _this = this;\n    var globie = document.getElementById('globie');\n\n    _this.ctx.rotate(_this.deg);\n    _this.ctx.drawImage(globie, 0, 500, 850, 850);\n\n    $('#caption').html('Globie visits ' + _this.place);\n\n    _this.saveImage();\n\n  },\n\n  saveImage: function() {\n    var _this = this;\n    var canvasData = _this.canvas.toDataURL('image/png');\n\n    document.getElementById('output').src = canvasData;\n\n  },\n\n  urlToData: function(url, callback, outputFormat) {\n    var img = new Image();\n\n    img.crossOrigin = 'Anonymous';\n    img.onload = function(){\n      var canvas = document.createElement('CANVAS');\n      var ctx = canvas.getContext('2d');\n      var dataURL;\n\n      canvas.height = this.height;\n      canvas.width = this.width;\n      ctx.drawImage(this, 0, 0);\n      dataURL = canvas.toDataURL(outputFormat);\n      callback(dataURL);\n      canvas = null;\n    };\n\n    img.src = url;\n}\n\n};\n\njQuery(document).ready(function () {\n  'use strict';\n\n  Generator.init();\n\n});"],"sourceRoot":"/source/"}